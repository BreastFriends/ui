<div class="analysis-container" *ngIf="analysis">

    <!-- Images in Tabs -->
    <mat-card class="images-card">
        <mat-tab-group>
            <mat-tab label="Left">
                <div class="images-section">
                    <div class="image-item" *ngFor="let image of leftImages">
                        <img
                        [src]="image.image_uri"
                        [alt]="image.view_type + ' ' + image.breast_side"
                        (click)="openImageDialog(image)"
                        />
                        <div class="image-label">{{ image.breast_side }}_{{ image.view_type }}</div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="Right">
                <div class="images-section">
                    <div class="image-item" *ngFor="let image of rightImages">
                        <img
                        [src]="image.image_uri"
                        [alt]="image.view_type + ' ' + image.breast_side"
                        (click)="openImageDialog(image)"
                        />
                        <div class="image-label">{{ image.breast_side }}_{{ image.view_type }}</div>
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
    </mat-card>

    <!-- Detected Lesions -->
    <mat-card class="lesions-card" *ngIf="analysis.lesions && analysis.lesions.length">
        <mat-card-header>
            <mat-card-title>Detected Lesions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <ul>
                <li *ngFor="let lesion of analysis.lesions">
                    <strong>{{ lesion.lesion_type }}</strong>
                    ({{ lesion.confidence * 100 | number:'1.0-0' }}% confidence) â€“
                    Dimensions: {{ lesion.width_mm }}mm x {{ lesion.height_mm }}mm, Area: {{ lesion.area_pixels }} pixels.
                </li>
            </ul>
        </mat-card-content>
    </mat-card>

    <!-- Analysis Information -->
    <mat-card class="analysis-info-card">
        <mat-card-header>
            <mat-card-title>Analysis Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <p><strong>BIRADS Score:</strong> {{ analysis.birads_score }}</p>
            <p><strong>BIRADS Confidence:</strong> {{ analysis.birads_confidence | percent:'1.0-0' }}</p>
            <p><strong>Created At:</strong> {{ analysis.created_at | date:'medium' }}</p>
        </mat-card-content>
    </mat-card>

    <!-- Radiologist BIRADS Score -->
    <mat-card class="radiologist-birads-card">
        <mat-card-header>
            <mat-card-title>Radiologist BIRADS Score</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <mat-form-field appearance="outline">
                <input matInput [(ngModel)]="analysis.radiologist_birads_score" placeholder="Enter Radiologist BIRADS Score" (ngModelChange)="onRadiologistBiradsScoreChange()">
            </mat-form-field>
        </mat-card-content>
    </mat-card>

    <!-- Doctor's Notes -->
    <mat-card class="radiologist-notes-card">
        <mat-card-header>
            <mat-card-title>Doctor's Notes</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <mat-form-field appearance="outline">
                <textarea matInput rows="10" [(ngModel)]="analysis.notes" placeholder="Enter Doctor's Notes"></textarea>
            </mat-form-field>
        </mat-card-content>
        <mat-card-content>
            <button mat-flat-button color="primary" (click)="onNotesSave()">Save Notes</button>
        </mat-card-content>
    </mat-card>
</div>
